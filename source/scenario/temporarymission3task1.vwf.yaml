# Copyright 2014 Lockheed Martin Corporation
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may 
# not use this file except in compliance with the License. You may obtain 
# a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software 
# distributed under the License is distributed on an "AS IS" BASIS, 
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and 
# limitations under the License.

---
extends: ../scenario/scenario.vwf
properties:
  scenarioName: Mission3Task1

  scenePath: /
  nextScenarioPath: "Mission3Task2"

  startState:
  - setProperty:
    - videoManager  
    - url 
    - [ "assets/video/successCutscene02_newAudio.mp4" ]
  # objective
  - setObjective:
    - "Graph a line that matches the slope of the tracks."
  # sounds/music
  - playSound:
    - musicStandardGameplay
  - playSound:
    - environmentWind
  # Perry, Rosie disabled
  - setProperty:
    - rover2
    - visible
    - false
  - setProperty:
    - rover3
    - visible
    - false
  - setProperty:
    - minirover
    - visible
    - false
  - setProperty:
    - rover
    - battery
    - 40
  - setProperty:
    - rover
    - batteryMax
    - 40
  - setProperty:
    - rover
    - blockly_allowedBlocks
    - 12
  - addToGrid:
    - rover
    - [ -41, 51 ]
  - callMethod:
    - rover
    - setHeading
    - 0
  - addToGrid:
    - blocklyGraph
    - [ -41, 51 ]
  - setGridAxes:
    - 51
    - -41
  - enableBlocklyNodes:
    - rover
    - graph
  - loadToolbox:
    - rover
    - source/scenario/blockly/scenario3d.xml
  - loadToolbox:
    - graph
    - source/scenario/blockly/graph.xml
  - setProperty:
    - blocklyLine
    - opacity
    - 1

children:
  triggerManager:
    extends: ../triggers/triggerManager.vwf
    properties: 
      triggers$:
        playStartingVO_3d:
          triggerCondition:
          - and:
            - doOnce:
            - onScenarioStart:
          actions:
          - playSound:
            - TM3VO1_MC
          - playSound:
            - L3VO6_Rover

        failOnMove_3d:
          group: successOrFailure
          priority: 1
          triggerCondition:
          - onMoved:
            - rover
          actions:
          - scenarioFailure:
            - lost
            - "You need to plot the course of the wayward rover before going to find it."
          - playSound:
            - FCVO4_Rover

        succeedOnSuccessfulCoursePlot_3d:
          group: successOrFailure
          priority: 0
          triggerCondition:
          - and:
            - blocklyLineEval:
              - [ 2, 5 ]
            - blocklyLineEval:
              - [ -2, -5 ]
          actions:
          - scenarioSuccess:
          - showAlert:
            - "Course Plotted: Navigation Program Update Required"
          - playSound:
            - L3_VO4S
          - playSound:
            - musicSuccessShort
  brief:
    extends: ../missionBrief.vwf
    properties:
      title: "Mission 3, Task 1"
      content: >
        Your minirover has gone off! You need to find
        him in order to make contact with the humans once again.
        It appears he's gone off in the direction of the base pod, follow 
        his tracks and see what you might find.

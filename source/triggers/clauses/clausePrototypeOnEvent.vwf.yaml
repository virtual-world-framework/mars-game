# Copyright 2014 Lockheed Martin Corporation
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may 
# not use this file except in compliance with the License. You may obtain 
# a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software 
# distributed under the License is distributed on an "AS IS" BASIS, 
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and 
# limitations under the License.

# The boolean function factory creates boolean function from yaml declarations.
# It also sets up the callbacks necessary to know when the boolean function 
# needs to be reevaluated. This is used to create the checks for triggers.
#
# A boolean function contains a single "clause," which is something we want to
# check (for example, an isAtPosition clause, or a hasObject clause).  The 
# clause can be an and, or, or not clause, and these clauses contain sub-
# clauses.
#
# This all leans on the declarative function executor, which treats the clauses
# as declarative functions that set up the necessary callbacks and return the
# function that performs the actual check.

--- 
extends: source/triggers/clauses/clause.vwf

properties:
  # how recent does the event have to have been?
  threshold$:

  # when did the event last happen?
  lastEventTime$:

methods:
  # This function should be called by every child from inside of onGenerated.
  #   It handles shared parts of the initialization.  Arguments are the same as
  #   onGenerated, plus the value for threshold$ (since I don't know which 
  #   parameter it will be).
  # NOTE: I call initClause, so you don't have to.
  initOnEvent:

  # call this when the event occurs, and the magic will happen.
  onEvent:

  # resets lastEventTime$ when we trigger, so that we won't trigger more than
  #  once off of a single move.
  onTrigger:

scripts:
- source: source/triggers/clauses/clausePrototypeOnEvent.js
